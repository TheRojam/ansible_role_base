---
- name: Install some common Debian specific packages
  become: yes
  apt:
    package:
      - debian-goodies
      - apt-dater-host
      - apt-transport-https
    state: present
    update_cache: yes
    cache_valid_time: 43200
  when:
    - ansible_machine != 'armv6l' and ansible_distribution_release != 'wheezy'

- name: add eth zurich apt
  become: true
  apt_repository:
    repo: deb https://debian.ethz.ch/debian/ {{ ansible_distribution_release }} main
    state: present
  when:
    - not base_pkg_non_free_firmware | bool
    - not base_pkg_contrib | bool
    - add_ethz | bool
    - ansible_distribution == 'Debian'
    - ansible_machine != 'armv6l' and ansible_distribution_release != 'wheezy'

- name: add eth zurich apt
  become: true
  apt_repository:
    repo: deb-src https://debian.ethz.ch/debian/ {{ ansible_distribution_release }} main non-free
    state: present
  when:
    - base_pkg_non_free_firmware | bool
    - not base_pkg_contrib | bool
    - add_ethz | bool
    - ansible_distribution == 'Debian'
    - ansible_machine != 'armv6l' and ansible_distribution_release != 'wheezy'

- name: remove eth zurich apt
  become: true
  apt_repository:
    repo: deb-src https://debian.ethz.ch/debian/ {{ ansible_distribution_release }} main non-free
    state: absent
  when:
    - base_pkg_non_free_firmware | bool
    - not base_pkg_contrib | bool
    - not add_ethz | bool
    - ansible_distribution == 'Debian'
    - ansible_machine != 'armv6l' and ansible_distribution_release != 'wheezy'

- name: add eth zurich apt + contrib + non-free
  become: true
  apt_repository:
    repo: deb-src https://debian.ethz.ch/debian/ {{ ansible_distribution_release }} main contrib non-free
    state: present
  when:
    - base_pkg_non_free_firmware | bool
    - base_pkg_contrib | bool
    - add_ethz | bool
    - ansible_distribution == 'Debian'
    - ansible_machine != 'armv6l' and ansible_distribution_release != 'wheezy'

- name: remove eth zurich apt + contrib + non-free
  become: true
  apt_repository:
    repo: deb-src https://debian.ethz.ch/debian/ {{ ansible_distribution_release }} main contrib non-free
    state: absent
  when:
    - base_pkg_non_free_firmware | bool
    - base_pkg_contrib | bool
    - not add_ethz | bool
    - ansible_distribution == 'Debian'
    - ansible_machine != 'armv6l' and ansible_distribution_release != 'wheezy'
